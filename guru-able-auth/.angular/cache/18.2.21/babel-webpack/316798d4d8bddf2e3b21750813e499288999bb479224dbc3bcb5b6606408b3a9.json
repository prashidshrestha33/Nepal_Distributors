{"ast":null,"code":"import { environment } from '../../environments/environment';\nimport { tap } from 'rxjs/operators';\nimport { Observable, throwError } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let AuthService = /*#__PURE__*/(() => {\n  class AuthService {\n    constructor(http) {\n      this.http = http;\n      this.api = environment.apiUrl;\n    }\n    // Standard email/password login (calls backend and saves token)\n    login(email, password) {\n      return this.http.post(`${this.api}/api/auth/login`, {\n        email,\n        password\n      }).pipe(tap(res => this.saveToken(res?.token)));\n    }\n    // Register endpoint (calls backend and saves token)\n    register(payload) {\n      return this.http.post(`${this.api}/api/auth/register`, payload).pipe(tap(res => this.saveToken(res?.token)));\n    }\n    // Server-side social login endpoints (exchange idToken/accessToken for your JWT)\n    googleLogin(idToken) {\n      return this.http.post(`${this.api}/api/auth/google`, {\n        idToken\n      }).pipe(tap(res => this.saveToken(res?.token)));\n    }\n    facebookLogin(accessToken) {\n      return this.http.post(`${this.api}/api/auth/facebook`, {\n        accessToken\n      }).pipe(tap(res => this.saveToken(res?.token)));\n    }\n    // Opens a popup to start the OAuth flow on your backend and listens for a postMessage\n    // from the popup window. Your backend route should perform the OAuth dance and, on\n    // completion, post a message back to the opener window like:\n    // window.opener.postMessage({ type: 'oauth-success', token: '<JWT>' }, '<your-origin>');\n    // or on error:\n    // window.opener.postMessage({ type: 'oauth-error', message: '...' }, '<your-origin>');\n    //\n    // Usage:\n    // auth.signInWithProvider('google').subscribe({ next: () => ..., error: () => ... })\n    signInWithProvider(provider) {\n      if (!provider) {\n        return throwError(() => new Error('Provider is required'));\n      }\n      const popupUrl = `${this.api}/api/auth/${provider}/redirect`; // adjust to your backend route\n      const width = 600;\n      const height = 700;\n      const left = window.screenX + (window.outerWidth - width) / 2;\n      const top = window.screenY + (window.outerHeight - height) / 2;\n      const features = `width=${width},height=${height},left=${left},top=${top},resizable=yes,scrollbars=yes`;\n      return new Observable(observer => {\n        const popup = window.open(popupUrl, `oauth_${provider}`, features);\n        if (!popup) {\n          observer.error(new Error('Unable to open authentication popup'));\n          return;\n        }\n        let intervalId = null;\n        const receiveMessage = event => {\n          // Optionally validate event.origin here if your backend posts only to your known origin.\n          // Example: if (event.origin !== window.location.origin) return;\n          const data = event.data || {};\n          if (data.type === 'oauth-success') {\n            try {\n              this.saveToken(data.token);\n            } catch {}\n            cleanup();\n            observer.next(data);\n            observer.complete();\n          } else if (data.type === 'oauth-error') {\n            cleanup();\n            observer.error(new Error(data.message || 'OAuth error'));\n          }\n        };\n        const cleanup = () => {\n          try {\n            window.removeEventListener('message', receiveMessage);\n          } catch {}\n          if (intervalId) {\n            clearInterval(intervalId);\n            intervalId = null;\n          }\n          try {\n            popup.close();\n          } catch {}\n        };\n        window.addEventListener('message', receiveMessage, false);\n        // Poll for popup closed without a message (user cancelled)\n        intervalId = setInterval(() => {\n          if (popup.closed) {\n            cleanup();\n            observer.error(new Error('Authentication popup closed before completion'));\n          }\n        }, 500);\n        // Teardown logic if subscriber unsubscribes\n        return () => {\n          cleanup();\n        };\n      });\n    }\n    // Local token helpers\n    saveToken(token) {\n      if (token) {\n        localStorage.setItem('token', token);\n      }\n    }\n    getToken() {\n      return localStorage.getItem('token');\n    }\n    logout() {\n      localStorage.removeItem('token');\n    }\n    isAuthenticated() {\n      return !!this.getToken();\n    }\n    static {\n      this.ɵfac = function AuthService_Factory(__ngFactoryType__) {\n        return new (__ngFactoryType__ || AuthService)(i0.ɵɵinject(i1.HttpClient));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: AuthService,\n        factory: AuthService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return AuthService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}