<div class="flex flex-col justify-center flex-1 w-full max-w-3xl mx-auto p-4">
  <h2 class="mb-2 font-semibold text-gray-800 text-title-sm dark:text-white/90 sm:text-title-md">
    Step 1 — Add Company
  </h2>

  <div class="bg-white shadow-lg rounded-xl p-5 border border-gray-200">
    <form [formGroup]="form" (ngSubmit)="onSubmit()">
      <div class="grid grid-cols-1 gap-3">

        <!-- BASIC INFORMATION -->
        <section class="mb-3">
          <h3 class="text-sm font-semibold mb-2" style="color: var(--color-gray-700);">
            Basic Information
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Company Name <span class="text-error-500">*</span>
              </label>
              <input
                formControlName="name"
                placeholder="Enter company name"
                required
                class="h-11 w-full rounded-lg border px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 bg-transparent text-gray-800 border-gray-300"
              />
              <p *ngIf="name?.invalid && name?.touched" class="mt-1 text-sm text-red-600">Company name is required</p>
            </div>

            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Company Person <span class="text-error-500">*</span>
              </label>
              <input
                formControlName="companyPerson"
                placeholder="Company person name"
                required
                class="h-11 w-full rounded-lg border px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 bg-transparent text-gray-800 border-gray-300"
              />
              <p *ngIf="companyPerson?.invalid && companyPerson?.touched" class="mt-1 text-sm text-red-600">Contact person is required</p>
            </div>
          </div>
        </section>

        <hr class="border-gray-200">

        <!-- CONTACT NUMBERS -->
        <section class="mb-3">
          <h3 class="text-sm font-semibold mb-2" style="color: var(--color-gray-700);">
            Contact Numbers
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Mobile Phone <span class="text-error-500">*</span>
              </label>
              <input
                type="text"
                formControlName="mobilePhone"
                placeholder="Mobile phone number"
                maxlength="10"
                required
                class="h-11 w-full rounded-lg border px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 bg-transparent text-gray-800 border-gray-300"
              />
              <p *ngIf="mobilePhone?.hasError('required') && mobilePhone?.touched" class="mt-1 text-sm text-red-600">Mobile phone is required</p>
              <p *ngIf="mobilePhone?.hasError('invalidPhoneFormat') && mobilePhone?.touched" class="mt-1 text-sm text-red-600">Mobile phone must contain only digits</p>
              <p *ngIf="mobilePhone?.hasError('phoneLengthInvalid') && mobilePhone?.touched" class="mt-1 text-sm text-red-600">Mobile phone must be between 7 and 10 digits</p>
            </div>

            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Landline Phone <span class="text-error-500">*</span>
              </label>
              <input
                type="text"
                formControlName="landLinePhone"
                placeholder="Landline phone number"
                maxlength="10"
                required
                class="h-11 w-full rounded-lg border px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 bg-transparent text-gray-800 border-gray-300"
              />
              <p *ngIf="landLinePhone?.hasError('required') && landLinePhone?.touched" class="mt-1 text-sm text-red-600">Landline phone is required</p>
              <p *ngIf="landLinePhone?.hasError('invalidPhoneFormat') && landLinePhone?.touched" class="mt-1 text-sm text-red-600">Landline phone must contain only digits</p>
              <p *ngIf="landLinePhone?.hasError('phoneLengthInvalid') && landLinePhone?.touched" class="mt-1 text-sm text-red-600">Landline phone must be between 7 and 10 digits</p>
            </div>
          </div>
        </section>

        <hr class="border-gray-200">

        <!-- COMPANY DETAILS -->
        <section class="mb-3">
          <h3 class="text-sm font-semibold mb-2" style="color: var(--color-gray-700);">
            Company Details
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Registration Document <span class="text-error-500">*</span>
              </label>

              <!-- Hidden file input (do NOT bind formControlName to file inputs) -->
              <input
                type="file"
                id="registrationDocument"
                class="hidden"
                (change)="onFileChange($event)"
                required
              />
              <p *ngIf="registrationDocument?.invalid && registrationDocument?.touched" class="mt-1 text-sm text-red-600">Registration document is required</p>

              <!-- Custom button with icon -->
              <label
                for="registrationDocument"
                class="inline-flex items-center gap-2 px-4 py-2 text-sm bg-gray-100 text-gray-700 rounded-md cursor-pointer border border-gray-300 hover:bg-gray-200 transition"
              >
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v16h16V4H4zm8 12v-8m0 0l-3 3m3-3l3 3"/>
                </svg>
                Choose File
              </label>

              <!-- Show selected file name -->
              <span id="file-name" class="ml-2 text-sm text-gray-500">{{ fileName }}</span>

            </div>

            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Company Type <span class="text-error-500">*</span>
              </label>
              <select
                formControlName="companyType"
                required
                aria-placeholder="Select Company Type"
                [disabled]="loadingCompanyTypes || companyTypes.length === 0"
                class="h-11 w-full rounded-lg border px-4 py-2.5 text-sm shadow-theme-xs bg-white focus:outline-none focus:ring-3 text-gray-800 border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed"
              >
                <option value="" class="text-gray-400">
                  {{ loadingCompanyTypes ? 'Loading company types...' : companyTypes.length === 0 ? 'No company types available' : 'Select company type' }}
                </option>
                <option *ngFor="let type of companyTypes" [value]="type.name">
                  {{ type.catalogType || type.catalogName || type.name }}
                </option>
              </select>
              <p *ngIf="companyType?.invalid && companyType?.touched" class="mt-1 text-sm text-red-600">Company type is required</p>
            </div>
          </div>
        </section>

        <hr class="border-gray-200">

        <!-- ADDITIONAL INFORMATION -->
        <section class="mb-3">
          <h3 class="text-sm font-semibold mb-2" style="color: var(--color-gray-700);">
            Additional Information
          </h3>
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Address <span class="text-error-500">*</span>
              </label>
              <input
                formControlName="address"
                placeholder="Company address"
                required
                class="h-11 w-full rounded-lg border px-4 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 bg-transparent text-gray-800 border-gray-300"
              />
              <p *ngIf="address?.invalid && address?.touched" class="mt-1 text-sm text-red-600">Address is required</p>
            </div>

            <div>
              <label class="block text-xs font-medium mb-1 text-gray-700">
                Geographical Location <span class="text-error-500">*</span>
              </label>

              <!-- Input + picker button -->
              <div class="relative">
                <input
                  formControlName="googleMapLocation"
                  placeholder="latitude,longitude — click the pin to pick"
                  readonly
                  required
                  class="h-11 w-full rounded-lg border px-4 pr-10 py-2.5 text-sm shadow-theme-xs placeholder:text-gray-400 focus:outline-none focus:ring-3 bg-transparent text-gray-800 border-gray-300"
                />
                <button
                  type="button"
                  (click)="openMapPicker()"
                  title="Open location picker"
                  class="absolute inset-y-0 right-0 pr-1 flex items-center"
                >
                  <span class="inline-flex items-center justify-center h-8 w-8 rounded-md bg-gray-100 hover:bg-gray-200 border border-gray-300 text-gray-700">
                    <!-- simple pin icon -->
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 2C8.686 2 6 4.686 6 8c0 5.25 6 12 6 12s6-6.75 6-12c0-3.314-2.686-6-6-6zm0 8.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"/>
                    </svg>
                  </span>
                </button>
              </div>

              <p *ngIf="googleMapLocation?.invalid && googleMapLocation?.touched" class="mt-1 text-sm text-red-600">Geographical location is required</p>
            </div>
          </div>
        </section>

        <!-- BUTTON -->
        <div class="pt-2 flex justify-center">
          <button
            type="submit"
            [disabled]="loading || form.invalid"
            class="flex items-center justify-center px-16 py-2 text-sm font-medium text-white transition rounded-lg bg-brand-500 shadow-theme-xs hover:bg-brand-600 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <span *ngIf="loading" class="inline-block w-4 h-4 mr-2 border-2 border-gray-300 border-t-white rounded-full animate-spin"></span>
            Next
          </button>
        </div>

        <!-- Validation summary -->
        <div *ngIf="form.invalid && (form.touched || form.dirty)" class="mt-3 text-sm text-red-600">
          Please fill all required fields before proceeding.
        </div>

        <!-- Feedback -->
        <div *ngIf="createdCompanyId" class="text-green-600 text-xs">
          Created company ID: {{ createdCompanyId }}
        </div>
        <div *ngIf="error" class="text-red-600 text-xs">
          {{ error }}
        </div>

      </div>
    </form>
  </div>
</div>


      <!-- Map picker modal -->
      <div *ngIf="showMapModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
        <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl h-[70vh] flex flex-col overflow-hidden">
          <div class="flex items-center justify-between p-3 border-b">
            <h3 class="text-sm font-semibold">Select location</h3>
            <div class="space-x-2">
              <button class="px-3 py-1 rounded-md text-sm bg-gray-100 hover:bg-gray-200" (click)="closeMapPicker()">Cancel</button>
              <button class="px-3 py-1 rounded-md text-sm bg-brand-500 text-white hover:bg-brand-600" (click)="saveLocation()">Save Location</button>
            </div>
          </div>

          <!-- map container -->
          <div class="flex-1 overflow-hidden">
            <div #mapContainer id="company-map" style="width: 100%; height: 100%;"></div>
          </div>
        </div>
      </div>
