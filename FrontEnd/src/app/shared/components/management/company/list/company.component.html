<div *ngIf="successModal2" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: flex; justify-content: center; align-items: center;">
  <div style="background: white; padding: 20px; border: 1px solid black; width: 300px; text-align: center;">
    <h3>Success</h3>
    <p>{{ successMessage2 }}</p>
    <button (click)="successModal2 = false">OK</button>
  </div>
</div><!-- Approve Confirmation Modal -->
<div *ngIf="showApproveModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">

  <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl p-6 custompopupmodel overflow-auto">
    <h2 class="text-lg font-semibold text-gray-800  mb-4">
      Approve Company
    </h2>
<div class="custom model-body">
  
    <table class="w-full text-left border border-gray-200  mb-4">
      <tbody>

        <tr class="border-b">
          <th class="px-4 py-2">Name</th>
          <td class="px-4 py-2">{{ companylst.name || '-' }}</td>
        </tr>

        <tr class="border-b">
          <th class="px-4 py-2">Email</th>
          <td class="px-4 py-2">{{ companylst.email || '-' }}</td>
        </tr>

        <tr class="border-b">
          <th class="px-4 py-2">Mobile Phone</th>
          <td class="px-4 py-2">{{ companylst.mobilePhone || '-' }}</td>
        </tr>

        <tr class="border-b">
          <th class="px-4 py-2">Contact Person</th>
          <td class="px-4 py-2">{{ companylst.contactPerson || '-' }}</td>
        </tr>

        <!-- STATUS -->
        <tr class="border-b">
          <th class="px-4 py-2">Status</th>
          <td class="px-4 py-2">
            <span
              [ngClass]="{
                'bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-200': companylst.status === 'active',
                'bg-gray-200 text-gray-800 ': companylst.status === 'inactive',
                'bg-yellow-200 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': companylst.status === 'pending'
              }"
              class="inline-block px-3 py-1 rounded-full text-xs font-semibold">
              {{ companylst.status | titlecase }}
            </span>
          </td>
        </tr>

        <tr class="border-b">
          <th class="px-4 py-2">Location</th>
          <td class="px-4 py-2">{{ companylst.location || '-' }}</td>
        </tr>

        <!-- GOOGLE MAP -->
        <tr class="border-b">
          <th class="px-4 py-2">Google Map</th>
          <td class="px-4 py-2">
   <iframe
  *ngIf="getGoogleMapUrl(companylst.googleMapLocation) as mapUrl"
  [src]="mapUrl | safeHtml:'url'"
  class="w-full h-48 rounded-lg border"
  loading="lazy">
</iframe>

<span *ngIf="!getGoogleMapUrl(companylst.googleMapLocation)">
  No map available
</span>
          </td>
        </tr>

        <!-- DOCUMENT -->
        <tr>
          <th class="px-4 py-2">Registration Document</th>
          <td class="px-4 py-2">
            <ng-container *ngIf="companylst.registrationDocument; else noDoc">

          <img
  *ngIf="isImage(companylst.registrationDocument)"
  [src]="getFileUrl(companylst.registrationDocument)"
  class="max-w-xs max-h-40 rounded-lg border cursor-pointer"
  (click)="openImage(companylst.registrationDocument)" />
              <a
                *ngIf="isPDF(companylst.registrationDocument)"
                [href]="getFileUrl(companylst.registrationDocument)"
                target="_blank"
                class="text-blue-500 hover:underline">
                View PDF
              </a>

              <span
                *ngIf="!isImage(companylst.registrationDocument) && !isPDF(companylst.registrationDocument)"
                class="text-gray-500">
                Unsupported document format
              </span>

            </ng-container>

            <ng-template #noDoc>
              <span class="text-gray-500">No document</span>
            </ng-template>
          </td>
        </tr>

      </tbody>
    </table>
</div>
    <div class="flex justify-end gap-3">
      <button
        (click)="closeApproveModal()"
        class="px-4 py-2 rounded-lg border">
        Cancel
      </button>
  <button
        (click)="openApprovestep1Modal('r')"
        class="px-4 py-2 rounded-lg bg-red-500 text-white">
        Reject
      </button>
      <button
        (click)="openApprovestep1Modal('a')"
        class="px-4 py-2 rounded-lg bg-green-500 text-white">
        Approve
      </button>
    </div>
  </div>
</div>
<div *ngIf="showApproveModal1"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
{{isreject}}
  <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl p-6 custompopupmodel1">
    <h2 class="text-lg font-semibold text-gray-800  mb-4"  *ngIf="!isreject">
      Approve Company
    </h2>  <h2 class="text-lg font-semibold text-gray-800  mb-4 bg-red-500"  *ngIf="isreject">
      Reject Company
    </h2>
<div class="custom model-body1">
  <div class="w-full"  *ngIf="!isreject">
  <label class="block text-sm font-medium mb-1">Select Catagory</label>
  <ng-select
  [items]="nestedCategories"
  bindLabel="name"
  class="Selectorcustom"
  bindValue="id"
  [multiple]="true"
  [closeOnSelect]="false"
  [searchable]="true"
  placeholder="Select categories"
  [(ngModel)]="selectedCategoryIds"
  class="w-full">

  <ng-template ng-label-tmp let-item="item">
    <span [style.paddingLeft.px]="(item.depth || 0) * 10">{{ item.name }}</span>
  </ng-template>

  <ng-template ng-option-tmp let-item="item">
    <span [style.paddingLeft.px]="(item.depth || 0) * 20">{{ item.name }}</span>
  </ng-template>
</ng-select>
</div>
<div class="w-full" *ngIf="isreject">
  <label class="block text-sm font-medium mb-1">
    Reject Reason
  </label>

  <textarea
    [(ngModel)]="rejectReason"
    name="rejectReason"
    rows="3"
    placeholder="Enter rejection reason"
    class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-400">
  </textarea>
</div>
</div>
    <div class="flex justify-end gap-3">
      <button
        (click)="closeApproveModal()"
        class="px-4 py-2 rounded-lg border">
        Cancel
      </button>
 <button
        (click)="confirmApprove()"
        class="px-4 py-2 rounded-lg bg-green-500 text-white">
        <span *ngIf="isreject">Reject </span>
        <span *ngIf="!isreject">Approve </span>
      </button>
    
    </div>
  </div>
</div>
<!-- 
<div *ngIf="showApproveModal2"
     class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg w-full max-w-3xl p-6 custompopupmodel1">
    <h2 class="text-lg font-semibold text-gray-800  mb-4" >
      Send Register Link
    </h2>  
<div class="custom model-body1">
 <div *ngIf="errorModal2" class="bg-red-50  p-4 rounded-lg text-red-700 ">
    {{ errorModal2 }}
  </div>
<div class="w-full">
  <label class="block text-sm font-medium mb-1">Select Roles</label>

<ng-select
  [items]="StaticValue"
  bindLabel="staticValueKey"   
  bindValue="staticData"      
  placeholder="Select Roles"
  [(ngModel)]="selectedStaticValueId"
  class="Selectorcustom w-full">

  <ng-template ng-label-tmp let-item="item">
    {{ item.staticValueKey }}
  </ng-template>

  <ng-template ng-option-tmp let-item="item">
    {{ item.staticData }}
  </ng-template>

</ng-select>

</div>
<div class="w-full" *ngIf="isreject">
  <label class="block text-sm font-medium mb-1">
    Email ID
  </label>
<input 
      type="text" 
      placeholder="Enter Register Email ID............." 
    [(ngModel)]="RegisterEmailID"
    name="RegisterEmailID" class="w-full border rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-red-400"
    />
    
  
</div>
</div>
    <div class="flex justify-end gap-3">
      <button
        (click)="closeApproveModal2()"
        class="px-4 py-2 rounded-lg border">
        Cancel
      </button> 
<button
        (click)="RegisterNewUserLink()"
        class="px-4 py-2 rounded-lg bg-green-500 text-white">
        <span>Send Email</span>
      </button> 
    
    </div>
  </div>
</div> -->


<div class="space-y-6">
  <div class="flex justify-between items-center">
    <h1 class="text-2xl font-bold text-gray-800 ">Company Management</h1>
   
  </div>


  <!-- Search Bar -->
  <div class="bg-white rounded-lg shadow p-4">
    <input 
      type="text" 
      placeholder="Search by name, email, or phone..." 
      [(ngModel)]="searchTerm"
      (keyup)="onSearch()"
      class="w-full px-4 py-2 border border-gray-300  rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 ">
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="bg-blue-50 dark:bg-blue-900 p-4 rounded-lg text-blue-700 dark:text-blue-200">
    Loading Company...
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="bg-red-50  p-4 rounded-lg text-red-700 ">
    {{ error }}
  </div>

  <!-- Company Table -->
  <div class="bg-white rounded-lg shadow overflow-hidden">
    <table class="w-full">
      <thead class="bg-gray-100 border-b border-gray-200 ">
        <tr>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">Name</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">Componey Person</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">ComponeyType</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">MobilePhone</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">Phone</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">Status</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">Credits</th>
          <th class="px-6 py-3 text-left text-sm font-semibold text-gray-900 ">Created</th>
          <th class="px-6 py-3 text-center text-sm font-semibold text-gray-900 ">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let Company of filteredCompany" class="border-b border-gray-200  hover:bg-gray-50">
          <td class="px-6 py-4 text-sm text-gray-900 ">{{ Company.name }}</td>
          <td class="px-6 py-4 text-sm text-gray-900 ">{{ Company.contactPerson }}</td>
          <td class="px-6 py-4 text-sm text-gray-600 ">{{ Company.companyType }}</td>
          <td class="px-6 py-4 text-sm text-gray-600 ">{{ Company.mobilePhone }}</td>
          <td class="px-6 py-4 text-sm text-gray-600 ">{{ Company.landlinePhone }}</td>
          <td class="px-6 py-4">
            <span [ngClass]="{
              'bg-green-200 text-green-800 dark:bg-green-900 dark:text-green-200': Company.status === 'active',
              'bg-gray-200 text-gray-800 ': Company.status === 'inactive',
              'bg-yellow-200 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200': Company.status === 'pending'
            }" class="inline-block px-3 py-1 rounded-full text-xs font-semibold">
              {{ Company.status | titlecase }}
            </span>
          </td>
          <td class="px-6 py-4 text-sm text-gray-600 ">
            {{ Company.createdAt | date: 'MMM dd, yyyy' }}
          </td>
          <td class="px-6 py-4 text-sm text-gray-600 ">{{ Company.credits }}</td>
          <td class="px-6 py-4 text-center">
            <div class="flex justify-center gap-2">
                 <button
  (click)="openCompanyProfile(Company.id!)"
  class="text-purple-500 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 text-sm font-semibold flex items-center gap-1">
  <!-- Tick icon -->  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.477 0 8.268 2.943 9.542 7-1.274 4.057-5.065 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
</svg>

</button>
     <button
  (click)="openUsersList(Company.id!)"
  class="text-brown-500 hover:text-brown-700 dark:text-brown-400 dark:hover:text-brown-300 text-sm font-semibold flex items-center gap-1">
 <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
  <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4z" />
  <path fill-rule="evenodd" d="M12 14c-4.418 0-8 1.79-8 4v2h16v-2c0-2.21-3.582-4-8-4z" clip-rule="evenodd" />
</svg>

</button>
<button
  (click)="openRegisterUser(Company.id!)"
  class="text-green-500 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 text-sm font-semibold flex items-center gap-1">
  <!-- Tick icon -->  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8m0 0v10a2 2 0 01-2 2H5a2 2 0 01-2-2V8m18 0L12 13 3 8" />
  </svg>
</button>

<button
  (click)="openApproveModal(Company.id!)"
  class="text-blue-500 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 text-sm font-semibold flex items-center gap-1">
  <!-- Email / envelope icon -->

  <svg  xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
  </svg>
</button>

            </div>
          </td>
        </tr>
        <tr *ngIf="!loading && filteredCompany.length === 0">
          <td colspan="6" class="px-6 py-8 text-center text-gray-500 ">
            No Company found. Try adjusting your search.
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Info -->
  <div *ngIf="!loading && company.length > 0" class="flex justify-between items-center bg-white rounded-lg shadow p-4">
    <span class="text-sm text-gray-600 ">
      Showing {{ filteredCompany.length }} of {{ company.length }} Company    </span>
  </div>
</div>
