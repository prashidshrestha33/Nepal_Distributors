
<!-- Snackbar Notification -->
<div *ngIf="snackbar.show"
     [ngStyle]="{
       'background-color': snackbar.success ? 'rgba(16, 185, 129, 0.85)' : 'rgba(220, 38, 38, 0.85)'
     }"
     class="fixed top-6 right-6 z-50 px-6 py-3 rounded-lg shadow-lg text-white font-semibold transition-all duration-300 animate-fade-in">
  {{ snackbar.message }}
</div>

<div class="min-h-screen bg-gray-100 flex items-center justify-center p-6">
  <div class="w-full max-w-3xl bg-gray-50 shadow-xl rounded-2xl border border-gray-200  p-8 space-y-8">

    <h2 class="text-3xl font-extrabold text-gray-800  text-center">
      {{ editMode ? 'Update Product' : 'Add Product' }}
    </h2>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-6">

      <!-- Product Name -->
      <div class="space-y-1">
        <label class="block text-sm font-semibold text-gray-700 ">
          Name <span class="text-red-500">*</span>
        </label>
        <input
          type="text"
          formControlName="name"
          placeholder="Enter product name"
          class="w-full bg-gray-100 border border-gray-300  rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        />
        <span *ngIf="isFieldInvalid('name')" class="text-red-500 text-xs">
          Name is required.
        </span>
      </div>

      <!-- Product Details -->
      <div class="space-y-1">
        <label class="block text-sm font-semibold text-gray-700 ">
          Details
        </label>
        <textarea
          formControlName="description"
          rows="3"
          placeholder="Enter product description"
          class="w-full bg-gray-100 border border-gray-300  rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
        ></textarea>
      </div>
<!-- Product Images Upload -->
<div class="space-y-3">
  <label class="block text-sm font-semibold text-gray-700">
    Upload Images
  </label>

  <p class="text-xs text-gray-500">
    You can upload up to 8 images
    ({{ productImages.length }}/8)
  </p>

  <div class="flex flex-wrap gap-4">

    <!-- Add Image Box -->
    <div
      *ngIf="productImages.length < 8"
      (click)="fileInput.click()"
      class="w-32 h-32 border-2 border-dashed border-gray-300 
             rounded-xl flex flex-col items-center justify-center 
             cursor-pointer hover:border-blue-500 hover:bg-blue-50 transition"
    >
      <span class="text-3xl text-gray-400">+</span>
      <span class="text-xs text-gray-500 mt-1">Add a photo</span>
    </div>

    <!-- Image Thumbnails -->
    <div
      *ngFor="let img of productImages; let i = index"
      class="w-32"
    >
      <div class="relative w-32 h-32 rounded-xl overflow-hidden border">

        <!-- Image -->
        <img
          [src]="img.previewUrl"
          class="w-full h-full object-cover"
        />

        <!-- Delete Icon -->
        <button
  type="button"
  (click)="removeImage(i)"
  class="absolute top-2 right-2 bg-white rounded-full p-2 shadow 
         hover:bg-red-100 hover:text-red-600 transition duration-150"
>
  <!-- Clean trash bin icon -->
  <svg xmlns="http://www.w3.org/2000/svg"
       class="h-5 w-5 text-gray-700"
       fill="currentColor"
       viewBox="0 0 24 24">
    <path d="M9 3V4H4V6H5V19C5 20.1 5.9 21 7 21H17C18.1 21 19 20.1 19 19V6H20V4H15V3H9ZM7 6H17V19H7V6Z"/>
  </svg>
</button>
      </div>

      <!-- Set Default -->
      <div class="flex items-center mt-2 space-x-2">
        <input
          type="checkbox"
          [checked]="img.isDefault"
          (change)="setDefaultImage(i)"
          class="accent-blue-600"
        />
        <span class="text-xs text-gray-600">Set as default</span>
      </div>
    </div>
  </div>

  <!-- Hidden Input -->
  <input
    #fileInput
    type="file"
    multiple
    accept="image/*"
    class="hidden"
    (change)="onMultipleImageChange($event)"
  />
</div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <!-- Product Rate -->
        <div class="space-y-1">
            <label class="block text-sm font-semibold text-gray-700 ">
               Rate <span class="text-red-500">*</span>
            </label>
            <input
              type="number"
              formControlName="rate"
              placeholder="Rate"
              min="0"
              step="1"
              pattern="\d*"
              inputmode="numeric"
              class="w-full bg-gray-100 border border-gray-300  rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 no-spinner"
            />
            <span *ngIf="isFieldInvalid('rate')" class="text-red-500 text-xs">
             Rate is required.
            </span>
          </div>

        <!-- HS Code -->
        <div class="space-y-1">
          <label class="block text-sm font-semibold text-gray-700 ">HS Code</label>
           <input
            type="text"
            formControlName="hsCode"
            placeholder="HS Code"
            class="w-full bg-gray-100 border border-gray-300  rounded-lg px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
           />
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <!-- Category -->
        <div class="space-y-1 relative">
          <label class="block text-sm font-semibold text-gray-700 ">
            Category <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <button
              type="button"
              class="w-full bg-gray-100 border border-gray-300  rounded-lg px-4 py-2 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10"
              (click)="showCategoryMenu = !showCategoryMenu"
            >
              {{ getCategoryName(form.get('categoryId')?.value) || 'Select Category' }}
            </button>
            <!--Clear Category -->
            <button
              *ngIf="form.get('categoryId')?.value"
              type="button"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-red-600"
              (click)="clearCategory()"
            >
              ✕
            </button>

            <div *ngIf="showCategoryMenu" class="absolute z-10 mt-1 w-full bg-white border border-gray-300  rounded-lg shadow-lg max-h-64 overflow-auto">
              <ul>
                <li *ngFor="let cat of treeCategories">
                  <button
                    type="button"
                    class="w-full text-left px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-900"
                    (click)="selectCategory(cat)"
                  >
                    {{ cat.name }}
                  </button>
                </li>
              </ul>
            </div>
          </div>
          <span *ngIf="isFieldInvalid('categoryId')" class="text-red-500 text-xs">
            Category is required.
          </span>
        </div>

        <!-- Brand -->
        <div class="space-y-1 relative">
          <label class="block text-sm font-semibold text-gray-700 ">
            Brand <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <button
              type="button"
              class="w-full bg-gray-100 border border-gray-300  rounded-lg px-4 py-2 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10"
              (click)="showBrandMenu = !showBrandMenu"
            >
              {{ getBrandName(form.get('brandId')?.value) || 'Select Brand' }}
            </button>
            <!--Clear Brand -->
            <button
              *ngIf="form.get('brandId')?.value"
              type="button"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-red-600"
              (click)="clearBrand()"
            >
              ✕
            </button>

            <div *ngIf="showBrandMenu" class="absolute z-10 mt-1 w-full bg-white border border-gray-300  rounded-lg shadow-lg max-h-64 overflow-auto">
              <ul>
                <li *ngFor="let brand of filteredItems">
                  <button
                    type="button"
                    class="w-full text-left px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-900"
                    (click)="selectBrand(brand)"
                  >
                    {{ brand.staticValueKey }}
                  </button>
                </li>
              </ul>
            </div>
          </div>
          <span *ngIf="isFieldInvalid('brandId')" class="text-red-500 text-xs">
            Brand is required.
          </span>
        </div>
      </div>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
        <!-- Manufacturer -->
        <div class="space-y-1 relative">
          <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300">
            Manufacture <span class="text-red-500">*</span>
          </label>
          <div class="relative">
            <button
              type="button"
              class="w-full bg-gray-100 dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg px-4 py-2 text-left focus:outline-none focus:ring-2 focus:ring-blue-500 pr-10"
              (click)="showManufactureMenu = !showManufactureMenu"
            >
              {{ getManufactureName(form.get('manufacturerId')?.value) || 'Select Manufacture' }}
            </button>
            <!--Clear Brand -->
            <button
              *ngIf="form.get('manufacturerId')?.value"
              type="button"
              class="absolute right-2 top-1/2 -translate-y-1/2 text-gray-500 hover:text-red-600"
              (click)="clearManufacture()"
            >
              ✕
            </button>

            <div *ngIf="showManufactureMenu" class="absolute z-10 mt-1 w-full bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg shadow-lg max-h-64 overflow-auto">
              <ul>
                <li *ngFor="let manufacture of filteredManufacture">
                  <button
                    type="button"
                    class="w-full text-left px-4 py-2 hover:bg-blue-100 dark:hover:bg-blue-900"
                    (click)="selectManufacture(manufacture)"
                  >
                    {{ manufacture.staticValueKey }}
                  </button>
                </li>
              </ul>
            </div>
          </div>
          <span *ngIf="isFieldInvalid('manufacture')" class="text-red-500 text-xs">
            Manufacture is required.
          </span>
        </div>
      </div>
      <!-- Error -->
      <div *ngIf="error" class="text-red-600 font-medium text-sm p-3 bg-red-50 border border-red-300 rounded-lg">
        {{ error }}
      </div>      
      <!-- Buttons -->
      <div class="flex gap-4 justify-end">
        <button
          type="button"
          (click)="goBack()"
          class="bg-gray-500 hover:bg-gray-600 text-white font-bold px-6 py-2 rounded-lg shadow-md transition"
        >
          Cancel
        </button>
        <button
          type="submit"
          [disabled]="form.invalid || loading"
          class="px-6 py-2 rounded-lg font-bold shadow-md transition
                 bg-blue-600 text-white
                 hover:bg-blue-700
                 disabled:bg-gray-400
                 disabled:cursor-not-allowed
                 disabled:hover:bg-gray-400"
        >
          {{ loading ? (editMode ? 'Updating...' : 'Saving...') : (editMode ? 'Update Product' : 'Save Product') }}
        </button>
      </div>
    </form>
  </div>
</div>
