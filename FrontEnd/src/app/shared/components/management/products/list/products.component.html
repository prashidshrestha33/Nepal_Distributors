<div class="min-h-screen bg-gray-100 p-6 space-y-6">

  <!-- HEADER -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
    <div>
      <h1 class="text-3xl font-extrabold text-gray-800">Products</h1>
      <p class="text-sm text-gray-500">Manage and approve products</p>
    </div>

    <div class="flex flex-wrap gap-3">
      <button
        type="button"
        (click)="bulkApprove()"
        [disabled]="!canBulkApprove"
        class="px-5 py-2 rounded-lg font-semibold
               bg-green-600 text-white hover:bg-green-700
               disabled:bg-gray-400 transition"
      >
        Approve Selected
      </button>

      <!-- CSV -->
      <input #csvInput type="file" accept=".csv" (change)="onFileSelected($event)" class="hidden" />
      <button
        type="button"
        (click)="csvInput.click()"
        [disabled]="loading"
        class="px-5 py-2 rounded-lg font-semibold
               bg-emerald-600 text-white hover:bg-emerald-700
               disabled:bg-gray-400 transition"
      >
        {{ loading ? 'Importing...' : 'Import CSV' }}
      </button>

      <!-- Add -->
      <a
        routerLink="/products/add"
        class="px-5 py-2 rounded-lg font-semibold
               bg-blue-600 text-white hover:bg-blue-700 transition"
      >
        + Add Product
      </a>
    </div>
  </div>

  <!-- STATUS -->
  <div *ngIf="jobId" class="bg-green-50 border border-green-200 text-green-700 p-3 rounded-lg">
    Import started successfully. Job ID: <b>{{ jobId }}</b>
  </div>

  <div *ngIf="error" class="bg-red-50 border border-red-200 text-red-600 p-3 rounded-lg">
    {{ error }}
  </div>

  <!-- SEARCH -->
  <div class="bg-white rounded-xl shadow p-4">
    <input
      type="text"
      placeholder="Search products by name..."
      [(ngModel)]="searchTerm"
      (input)="onSearch()"
      class="w-full px-4 py-2.5 rounded-lg border border-gray-300 bg-gray-50
             focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition"
    />
  </div>

  <!-- LOADING -->
  <div *ngIf="loading" class="bg-blue-50 text-blue-700 p-4 rounded-lg">
    Loading products...
  </div>

  <!-- EMPTY -->
  <div
    *ngIf="!loading && filteredProducts?.length === 0"
    class="bg-yellow-50 text-yellow-700 p-4 rounded-lg text-center"
  >
    {{ searchTerm ? 'No products found matching your search' : 'No products available' }}
  </div>

  <!-- TABLE -->
  <div
    *ngIf="!loading && filteredProducts.length > 0"
    class="bg-white rounded-xl shadow overflow-hidden flex flex-col min-h-[520px]"
  >
    <table class="min-w-full">
      <thead class="bg-gray-50 border-b">
        <tr class="text-xs font-bold text-gray-600 uppercase">
          <th class="px-4 py-3">
            <input type="checkbox" [checked]="allSelected" (change)="toggleSelectAll($event)" />
          </th>
          <th class="px-4 py-3 text-left">S.N</th>
          <th class="px-6 py-3 text-left">Name</th>
          <th class="px-6 py-3 text-left">Category</th>
          <th class="px-6 py-3 text-left">Brand</th>
          <th class="px-6 py-3 text-left">Rate</th>
          <th class="px-6 py-3 text-left">Created By</th>
          <th class="px-6 py-3 text-left">Status</th>
          <th class="px-6 py-3 text-left">Actions</th>
        </tr>
      </thead>

      <tbody class="divide-y">
        <tr
          *ngFor="let product of filteredProducts; let i = index"
          class="hover:bg-gray-50 transition"
        >
          <td class="px-4 py-3">
            <input
              type="checkbox"
              [(ngModel)]="product.selected"
              (change)="updateBulkButtonState()"
            />
          </td>

          <td class="px-4 py-3 text-sm">
            {{ (currentPage - 1) * pageSize + i + 1 }}
          </td>

          <td class="px-6 py-3 text-sm font-medium text-gray-800">
            {{ product.name }}
          </td>

          <td class="px-6 py-3 text-sm">
            {{ getCategoryName(product.categoryId) }}
          </td>

          <td class="px-6 py-3 text-sm">
            {{ getBrandName(product.brandId) }}
          </td>

          <td class="px-6 py-3 text-sm font-semibold">
            Rs. {{ product.rate | number:'1.2-2' }}
          </td>

          <td class="px-6 py-3 text-sm">
            {{ product.createdBy }}
          </td>

          <td class="px-6 py-3 text-sm">
            <span
              class="px-2 py-1 rounded-full text-xs font-semibold"
              [ngClass]="product.status === 'Approved'
                ? 'bg-green-100 text-green-700'
                : 'bg-yellow-100 text-yellow-700'"
            >
              {{ product.status || 'Pending' }}
            </span>
          </td>

          <!-- ACTIONS -->
          <td class="px-6 py-3">
            <div class="flex gap-3">
              <!-- Approve -->
              <button
                (click)="approveProduct(product)"
                class="w-9 h-9 rounded-full bg-green-50 text-green-600
                       hover:bg-green-600 hover:text-white transition hover:scale-110"
                title="Approve"
              >
                ‚úî
              </button>

              <!-- View -->
              <a
                [routerLink]="['/products/details', product.id]"
                class="w-9 h-9 rounded-full bg-indigo-50 text-indigo-600
                       hover:bg-indigo-600 hover:text-white transition hover:scale-110
                       flex items-center justify-center"
                title="View"
              >
                üëÅ
              </a>

              <!-- Edit -->
              <button
                (click)="goToEditProduct(product.id)"
                class="w-9 h-9 rounded-full bg-blue-50 text-blue-600
                       hover:bg-blue-600 hover:text-white transition hover:scale-110"
                title="Edit"
              >
                ‚úè
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <!-- PAGINATION -->
    <div class="border-t bg-gray-50">
      <app-pagination
        [currentPage]="currentPage"
        [pageSize]="pageSize"
        [totalCount]="totalCount"
        (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)"
      ></app-pagination>
    </div>
  </div>

  <!-- APPROVE MODAL -->
  <ng-container *ngIf="showApproveModal">
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/40">
      <app-approve-product
        [product]="approveProductData"
        (approve)="onApproveSave($event)"
        (cancel)="onApproveCancel()"
      ></app-approve-product>
    </div>
  </ng-container>

</div>
