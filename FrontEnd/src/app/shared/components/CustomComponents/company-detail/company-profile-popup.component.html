<div
  class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4"
  *ngIf="company"
>
  <div class="bg-white w-full max-w-4xl rounded-xl shadow-lg p-6 relative">

    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h2 class="text-xl font-semibold">Company Profile</h2>

      <div class="flex gap-2">
        <!-- Edit Button -->
        <button
          *ngIf="!editMode"
          (click)="enableEdit()"
          title="Edit"
          class="text-blue-600 hover:text-blue-800 px-3 py-1 border rounded"
        >
          Edit
        </button>

        <!-- Close Button -->
        <button
          (click)="closePopup()"
          title="Close"
          class="text-gray-500 hover:text-gray-700 px-3 py-1 border rounded"
        >
          Close
        </button>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="text-center py-10">
      Loading...
    </div>

    <!-- Details -->
    <div *ngIf="!loading" class="grid grid-cols-1 md:grid-cols-2 gap-4">

      <!-- Name -->
      <div>
        <label class="block font-medium text-gray-700">Name:</label>
        <div *ngIf="!editMode" class="text-gray-900">{{ company.name }}</div>
        <input
          *ngIf="editMode"
          [(ngModel)]="company.name"
          class="w-full border rounded px-3 py-2"
        />
      </div>

      <!-- Contact Person -->
      <div>
        <label class="block font-medium text-gray-700">Contact Person:</label>
        <div *ngIf="!editMode" class="text-gray-900">{{ company.contactPerson }}</div>
        <input
          *ngIf="editMode"
          [(ngModel)]="company.contactPerson"
          class="w-full border rounded px-3 py-2"
        />
      </div>

      <!-- Mobile Phone -->
      <div>
        <label class="block font-medium text-gray-700">Mobile Phone:</label>
        <div *ngIf="!editMode" class="text-gray-900">{{ company.mobilePhone }}</div>
        <input
          *ngIf="editMode"
          [(ngModel)]="company.mobilePhone"
          class="w-full border rounded px-3 py-2"
        />
      </div>

      <!-- Landline Phone -->
      <div>
        <label class="block font-medium text-gray-700">Landline Phone:</label>
        <div *ngIf="!editMode" class="text-gray-900">{{ company.landlinePhone }}</div>
        <input
          *ngIf="editMode"
          [(ngModel)]="company.landlinePhone"
          class="w-full border rounded px-3 py-2"
        />
      </div>

      <!-- Company Type -->
      <div>
        <label class="block font-medium text-gray-700">Company Type:</label>
        <div class="text-gray-900">{{ company.companyType }}</div>
       
      </div>

      <!-- Location -->
      <div>
        <label class="block font-medium text-gray-700">Location:</label>
        <div *ngIf="!editMode" class="text-gray-900">{{ company.location }}</div>
        <input
          *ngIf="editMode"
          [(ngModel)]="company.location"
          class="w-full border rounded px-3 py-2"
        />
      </div>

 <!-- Google Map -->
<div class="col-span-1 md:col-span-2">
  <label class="block font-medium text-gray-700 mb-2">
    Google Map Location: {{ company.googleMapLocation }}
  </label>

  <!-- Leaflet map in edit mode -->
  <div
    #companyMapDiv
    *ngIf="editMode"
    class="w-full h-64 rounded-lg border"
  ></div>

  <!-- Fallback iframe in view mode -->
  <iframe
    *ngIf="!editMode && getGoogleMapUrl(company.googleMapLocation) as mapUrl"
    [src]="mapUrl"
    class="w-full h-48 rounded-lg border"
    loading="lazy">
  </iframe>

  <span *ngIf="!company.googleMapLocation && !editMode" class="text-gray-500">
    No map available
  </span>
</div>

      <!-- Registration Document -->
      <div class="col-span-1 md:col-span-2">
        <label class="block font-medium text-gray-700 mb-2">Registration Document:</label>

        <ng-container *ngIf="company.registrationDocument; else noDoc">
          <img
            *ngIf="isImage(company.registrationDocument)"
            [src]="getFileUrl(company.registrationDocument)"
            class="max-w-xs max-h-40 rounded-lg border cursor-pointer"
            (click)="openImage(company.registrationDocument)"
          />
          <a
            *ngIf="isPDF(company.registrationDocument)"
            [href]="getFileUrl(company.registrationDocument)"
            target="_blank"
            class="text-blue-500 hover:underline"
          >
            View PDF
          </a>
        </ng-container>

        <ng-template #noDoc>
          <span class="text-gray-500">No document available</span>
        </ng-template>
      </div>

    </div>

    <!-- Save / Cancel -->
    <div *ngIf="editMode" class="flex justify-end mt-6 gap-2">
      <button
        (click)="cancelEdit()"
        class="px-4 py-2 border rounded hover:bg-gray-100"
      >
        Cancel
      </button>
      <button
        (click)="save()"
        class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
      >
        Save
      </button>
    </div>

  </div>
</div>
